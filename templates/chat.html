{% extends 'base.html' %}

{% block head %}
<title>Flask Chat!</title>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js" integrity="sha512-q/dWJ3kcmjBLU4Qc47E4A9kTB4m3wuTY7vkFJDTZKjTs8jhyGQnaUrxa0Ytd0ssMZhbNua9hE+E7Qv1j+DyZwA==" crossorigin="anonymous"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
{% endblock %}

{% block body %}


<h1 class="title">Flask chat!</h1>

<div style="display:inline">
    Você está digitando mensagens como:
		<input id="user_input" type="text" name="user" value={{ user_info.get("user","Anônimo") }}>
		<div style="display:inline" class=notification>{{user_info.get("notification","")}}</div>
		
</div>
<div id="chatbox" style="overflow:auto" class="other_user">
	{% for msg in history %}
	{% if(msg.user) %}
	<div class={{msg.user+'_msg'}}>
		{{ "({})[{}]:{}".format(msg.date.strftime("%H:%M"), msg.user, msg.content) }}
	{% else %}
	<div class="system">
		{{ "({})~{}~".format(msg.date.strftime("%H:%M"), msg.content) }}
	{% endif %}
	</div>
	{% endfor %}
</div>
<div>
	<input id="msg_input" name="message" type="text" placeholder="Digite algo! :>">
	<input id="send_input" type="button" value="ENVIAR">
</div>

<footer style="text-align: center;">Feito pela Hikari :></footer>
{% endblock %}

{% block javascript %}
<script src={{ url_for('static', filename='js/chat.js') }} type="text/javascript"></script>
<script>
    //minor design fixes
    var chatbox = document.getElementById("chatbox")
    chatbox.style.height = (window.screen.height-parseInt(window.screen.height/2.6)).toString()+'px';
    chatbox.scrollTop = chatbox.scrollHeight - chatbox.clientHeight;

    var msg_input = document.getElementById("msg_input")
    console.log(chatbox.style.width)
    msg_input.style.width = (chatbox.offsetWidth-5-100).toString()+"px"
    msg_input.focus()
</script>
{% endblock %}